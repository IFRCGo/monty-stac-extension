# Monty Model

The [Monty model](./Montandon_Schema_V1-00.json) is maintained in the [GDBC repository](https://github.com/IFRCGo/GCDB)
and is used to generate the Monty model documentation. 
This JSON schema is the authoritative source for the Monty model and is used to build the STAC model.

## eoAPI risk

The STAC extension aims to provide a way to include Montandon data in STAC items and collections.
eoAPI risk is a flavor of [eoAPI](https://eoapi.dev/) dedicated to risk data.
The Monty model is transformed into a STAC model that is assimilable by the eoAPI data store.

## Model Normalization

The first step in the process is to normalize the Monty model.
This is done by converting the Monty model into a format that is easier to work with and compliant with the STAC specifications model.
The normalized model must keep all the information from the Monty model and cover the applications intented that will use the eoAPI risk data.

### Data Overview

The Monty model is based on events that consititute the core of the model. In STAC, they will be represented as an item. Then for each event,
3 kinds of data are collected:

- **Hazard**: The type of hazard, its location and the intensity
- **Impact**: All type of impact affecting the population, the infrastructure, the environment, etc
  in terms of number of people affected, financial loss, dmaage to infrastructure, etc.
- **Response**: Anticipatory measures and actions taken in response to the event

The original Monty model is a relational model with a lot of redundant taxonomy attributes in various forms (e.g. country code + name). 
In the STAC model, we try to use unambiguous and normalized attributes as much as possible
but keeping the capacity to query the data with the original taxonomy.
For example, the country code is used as a normalized attribute in a specific field but the country name is kept as a keyword for free text search.

The following classs diagram shows the relationships between the different classes in the Monty model and their high-level attributes.

``` mermaid
---
title: Montandon STAC Model
---
classDiagram
    class Item["STAC Item"] {
        
    }

    Item <|-- Event

    class Event {
        +id: string
        +title: string
        +geometry: GeoJson geometry
        +datetime: datetime
        +start_datetime: datetime
        +end_datetime: datetime
        +country_codes: string[]
        +hazard_codes: string[]
        +keywords: string[]
    }

    class ReferenceEvent["Reference Event"] {
    }

    class SourceEvent["Source Event"] {
        +correlation_id: string
    }

    Event <|-- ReferenceEvent
    Event <|-- SourceEvent

    SourceEvent "1..*" --> "1" ReferenceEvent : is paired with

    class Hazard {
    }

    class Impact {
    }

    class Response {
    }
```

### Event

The event class is the core of the Monty model. It represents a disaster event that has occured or is forecasted to occur.
The global crisis data bank records multiple instances of events that are related to a single event:

- One unique reference event that is used to "pair" all the instances of the event
- Multiple instances of the event that are recorded for different sources

The event class has the following attributes:

- **id**: A unique identifier for the event. Preferably, the identifier assigned by the issuer (source) of the event.
  - The reference event uses a [?](./questions.md) generated by the Monty system
  - The source events use the identifier assigned by the source (issuer) of the event
- Generated by the Monty system (currently [this method)](https://github.com/IFRCGo/Monty-IFRC/blob/main/API/helpers/DREF_forecasting.R#L13).
  This identifier is used as the correlation id for all the sources events registered in the Monty system.
- **title**: The name of the event assigned by the issuer (source) of the event.
- **geometry** (GeoJSON geometry): The location of the event in the form of a GeoJSON geometry.
  It is recommanded to use a point geometry for the event so that it can be easily searched, displayed and clustered on a map.
  More geometries can be used for the hazard, impact and response data to represent the affected area.
- **datetime**: The date and time when the event occurred.
  For forecasted events, it is the date and time when the event is forecasted to occur.
- **start_datetime**: The date and time when the event started.
  For forecasted events, it is the date and time when the event is forecasted to start.
- **end_datetime**: The date and time when the event ended.
  For forecasted events, it is the date and time when the event is forecasted to end.
- **country_codes**: The country codes of the countries affected by the event.
  The country codes are based on the [ISO 3166-1 alpha-3](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3) standard.
- **hazard_codes**: The hazard codes of the hazards affecting the event.
  The hazard codes are based on the [UNDRR-ISC 2020 Hazard Information Profiles](https://www.preventionweb.net/drr-glossary/hips)
- **correlation_id**: The unique identifier assigned by the Monty system to the reference event.
  It is used to "pair" all the instances of the event.
- **keywords**: A list of keywords that describe the event. This list includes the human-readable names of
  - the countries affected by the event
  - the hazard types affecting the event
