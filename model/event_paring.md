# Event Pairing (Correlation)

Generated by the Monty system (currently [this method](https://github.com/IFRCGo/Monty-IFRC/blob/main/API/helpers/DREF_forecasting.R#L13)). The event pairing page describes the algorithm used to generate the event id and the convention to follow.

This identifier is used as the correlation id for all the sources events registered in the Monty system. It is **REQUIRED** for every STAC item (event or data) to have this identifier.

## Event Pairing Algorithm

As indicated in the name, the event pairing algorithm is based on the event. For an item of the type event, this is the self-reference to the event. For an item of the type data, this is the reference to the event that generated the data.

The event pairing algorithm is a function that takes the following parameters:

- Hazards codes: An array with the codes of the event hazards based on [UNDRR-ISC 2020 Hazard Information Profiles](https://www.preventionweb.net/drr-glossary/hips). The codes are preferably sorted by order of importance in the event. This order is important to ensure that the same event is generated for the same hazards.
- Country code: The country code of the related event in the [ISO 3166-1 alpha-3](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3) format.
- Date and Time: The date and time of the related event.

The algorithm returns a string with the event id. The event id is a string with the following format:

```console
{datetime}-{country_code}-{hazard_cluster_code}-{episode_number}-GDBC
```

Where:

- `{datetime}`: The date and time of the event in the format `YYYYMMDDThhmmssZ` ([ISO 8601](https://en.wikipedia.org/wiki/ISO_8601)).
- `{country_code}`: The country code of the related event in the [ISO 3166-1 alpha-3](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3) format.
- `{hazard_cluster_code}`: A code that represents the cluster of the main hazards of the event. This code represents the cluster in the [UNDRR-ISC 2020 Hazard Information Profiles](./taxonomy.md#undrr-isc-2020-hazard-information-profiles). The cluster is slected based on the order of the hazards codes provided.
- `{episode_number}`: A number that represents the episode of the event. This number is used to differentiate between events that have the same date, country, and hazard cluster. The episode number starts at 1 and is incremented by 1 for each new event with the same date, country, and hazard cluster.

A reference implementation is provided with the pystac.monty module. *TBD*
